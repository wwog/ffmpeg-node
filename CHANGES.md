# æ›´æ–°è¯´æ˜

## æ„å»ºæµç¨‹é‡æ„

### æ”¹åŠ¨æ¦‚è¿°

ç®€åŒ–äº†æ„å»ºæµç¨‹ï¼Œç›´æ¥ä½¿ç”¨ vcpkg çš„æºç å’Œåº“æ–‡ä»¶ï¼Œä¸å†è¿›è¡Œæ–‡ä»¶å¤åˆ¶ã€‚

### æ–°çš„å·¥ä½œæµç¨‹

**æ­¥éª¤ 1: å®‰è£… vcpkg**
```bash
npm run install:vcpkg
```
- å®‰è£… vcpkg å’Œ FFmpeg
- æ‰€æœ‰æ–‡ä»¶ä¿ç•™åœ¨ `vcpkg/` ç›®å½•ä¸‹

**æ­¥éª¤ 2: å‡†å¤‡æ„å»º**
```bash
npm run prepare
```
- å®šä½ vcpkg æºç 
- å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°æºç ç›®å½•
- ç”Ÿæˆ `src/ffmpeg_crt.c`

**æ­¥éª¤ 3: ç¼–è¯‘**
```bash
npm run build
```

æˆ–è€…ä¸€æ¬¡å®Œæˆï¼š
```bash
npm install
```

### ä¸»è¦å˜åŒ–

#### âœ… ä¸å†ç”Ÿæˆçš„å†…å®¹
- âŒ `lib_work/` ç›®å½• - ä¸å†å¤åˆ¶åº“æ–‡ä»¶
- âŒ åŠ¨æ€ç”Ÿæˆçš„ `binding.gyp` - ç°åœ¨æ˜¯æ‰‹åŠ¨ç»´æŠ¤çš„å›ºå®šæ–‡ä»¶

#### âœ… æ–°å¢/ä¿ç•™çš„å†…å®¹
- âœ… `binding.gyp` - æ‰‹åŠ¨ç»´æŠ¤ï¼Œç›´æ¥å¼•ç”¨ vcpkg ç›®å½•
- âœ… `src/ffmpeg_crt.c` - è‡ªåŠ¨ç”Ÿæˆï¼ˆä» ffmpeg.c è½¬æ¢ï¼‰
- âœ… vcpkg é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°æºç ç›®å½•

#### ğŸ“ è„šæœ¬å˜åŒ–

**åˆ é™¤çš„è„šæœ¬ï¼š**
- `scripts/build_vcpkg.js` - åŸæ¥çš„å¤æ‚æ„å»ºè„šæœ¬
- `scripts/gen_ffmpeg.js` - åŠŸèƒ½å·²åˆå¹¶åˆ° `prepare.js`
- `scripts/vcpkg_installer.js` - è¢« `install_vcpkg.js` æ›¿ä»£

**æ–°å¢çš„è„šæœ¬ï¼š**
- `scripts/install_vcpkg.js` - åªè´Ÿè´£å®‰è£… vcpkg
- `scripts/prepare.js` - å‡†å¤‡æ„å»ºç¯å¢ƒ

**ä¿ç•™çš„è„šæœ¬ï¼š**
- `scripts/utils.js` - å·¥å…·å‡½æ•°

### binding.gyp è®¾è®¡

æ–°çš„ `binding.gyp` ç›´æ¥å¼•ç”¨ vcpkg ç›®å½•ï¼š

- **å¤´æ–‡ä»¶**: `vcpkg/installed/<triplet>/include`
- **åº“æ–‡ä»¶**: `vcpkg/installed/<triplet>/lib`
- **æºç **: `vcpkg/buildtrees/ffmpeg/src/<version>.clean`

æ‰€æœ‰è·¯å¾„åœ¨æ„å»ºæ—¶åŠ¨æ€è§£æï¼Œä½¿ç”¨ Node.js è¡¨è¾¾å¼ï¼ˆ`<!@(node -p "...")`ï¼‰ã€‚

### ä¼˜åŠ¿

1. **æ›´ç®€å•** - ä¸éœ€è¦ç»´æŠ¤ `lib_work` ç›®å½•
2. **æ›´å¿«** - ä¸éœ€è¦å¤åˆ¶å¤§é‡åº“æ–‡ä»¶
3. **æ›´æ¸…æ™°** - æ‰€æœ‰æ–‡ä»¶éƒ½åœ¨ vcpkg ç›®å½•ä¸‹ï¼Œç»“æ„æ¸…æ™°
4. **æ›´æ˜“ç»´æŠ¤** - `binding.gyp` æ˜¯å›ºå®šçš„ï¼Œä¸ä¼šæ¯æ¬¡æ„å»ºéƒ½å˜åŒ–

### æ³¨æ„äº‹é¡¹

- é¦–æ¬¡è¿è¡Œ `npm install` ä¼šèŠ±è´¹è¾ƒé•¿æ—¶é—´ï¼ˆvcpkg ç¼–è¯‘ FFmpegï¼‰
- `binding.gyp` ç°åœ¨éœ€è¦æ‰‹åŠ¨ç»´æŠ¤
- å¦‚æœä¿®æ”¹äº† FFmpeg é…ç½®ï¼Œéœ€è¦æ›´æ–° `scripts/install_vcpkg.js`

